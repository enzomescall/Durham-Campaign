---
title: "EDA"
author: "Enzo Moraes Mescall"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

```{r}
# Importing data
path = "./data/SC - Endorsment Data Analysis - "
precinct_df = read_csv(paste0(path, "precinct.csv"))
candidates_df = read_csv(paste0(path, "candidates.csv"))

aj_v_leo = read_csv(paste0(path, "AJ vs. Leo.csv"))
baker_v_caballero = read_csv(paste0(path, "Baker vs. Caballero vs. Rist vs. et. al.csv"))
johnson_v_reece = read_csv(paste0(path, "Johnson vs. Reece vs. Caballero vs. et. al.csv"))
murdock_v_freelon = read_csv(paste0(path, "Murdock vs. Freelon.csv"))
satana_v_echols = read_csv(paste0(path, "Satana vs. Echols (County Wide).csv"))
schewel_v_ali = read_csv(paste0(path, "Schewel vs. Ali.csv"))
```

## Methodology

Build a table which looks like this:

Result | Precinct | [Candidate 1 info ] | [Candidate 2 info] | [Population info]

Where results is the gap between the to candidates. In a multi-candidate election we can artificially turn it into a series of head-to-head races. We then want to regress on result as the dependent variable and identify the independent variables that are most predictive of the result.

```{r}
# Buliding the master table

# Demographic percentages of possible voters in the precinct
precinct_pct = data.frame(lapply(precinct_df %>% select(-precinct_id), function(x) x/precinct_df$Total)) %>%
  mutate(row = row_number()) %>%
  right_join(precinct_df %>% select(precinct_id) %>% mutate(row = row_number()), by = "row") %>%
  select(-row, -Total) %>%
  select(precinct_id, everything()) 
```

```{r}
pct_to_dec = function(string) {
  string = gsub("%", "", string)
  string = as.numeric(string)
  string = string/100
  return(string)
}


# Creating a function to clean up race dataframes
head_to_head = function(candidate_df, candidate_names){
  hth_df_list = c()
  
  # Create a matrix of all combination of candidate_names
  candidate_combinations = expand.grid(candidate_names, candidate_names) %>%
    filter(Var1 != Var2) %>%
    mutate(Var1 = as.character(Var1), Var2 = as.character(Var2))
  
  # Loop through the combinations of two names and create a new dataframe
  for(i in 1:nrow(candidate_combinations)){
    candidate_1 = candidate_combinations$Var1[i]
    candidate_2 = candidate_combinations$Var2[i]
    
    hth = candidate_df %>%
      select(Precinct,
             starts_with(candidate_1), starts_with(candidate_2),
             starts_with(paste0("%", candidate_1)),
             starts_with(paste0("%", candidate_2))) %>%
      mutate(c1_pct = pct_to_dec(get(paste0("%", candidate_1))),
             c2_pct = pct_to_dec(get(paste0("%", candidate_2))),
             result = c1_pct - c2_pct,
             c1_name = candidate_1,
             c2_name = candidate_2) %>%
      select(Precinct, c1_name, c2_name, result, c1_pct, c2_pct)
    hth_df_list = c(hth_df_list, hth)
  }
  return(hth_df_list)
}
```

```{r}
head_to_head(aj_v_leo, c("AJ Williams", "Leonardo Williams"))
```

```{r}
```


